#!/usr/bin/env ratch

# compile extensions

main :compile => [:compile_base64, :compile_scanner_c] do
end

task :compile_base64 do
  file = nil
  cd('ext/tmail/base64') do
    ruby "extconf.rb"
    make
    file = glob("base64.#{dlext}").first
    file = File.expand_path(file) if file
  end
  if file
    mkdir_p("lib/tmail/#{arch}")
    mv(file, "lib/tmail/#{arch}/")
  end
end

task :compile_scanner_c do
  file = nil
  cd("ext/tmail/scanner_c") do
    ruby "extconf.rb"
    make
    file = glob("scanner_c.#{dlext}").first
    file = File.expand_path(file) if file
  end
  if file
    mkdir_p("lib/tmail/#{arch}")
    mv(file, "lib/tmail/#{arch}/")
  end
end

def dlext
  Config::CONFIG['DLEXT']
end

def arch
  Config::CONFIG['arch']
end
