#!/usr/bin/env ratch

# Run unit tests

live = ARGV.delete('--live')

unless live
  $LOAD_PATH.unshift(File.expand_path('lib'))
end

main :test do
  if find = commandline[0]
    unless file?(find)
      find = File.join(find, '**', 'test_*.rb')
    end
  else
    find = '**/test_*.rb'
  end

  files = Dir.glob(find).map{ |f| File.join('..', f) }

  chdir('test') do
    files.each do |file|
      next unless file?(file)
      load file
    end
  end
end

